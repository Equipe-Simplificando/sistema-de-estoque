<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Projeto</title>
    <link rel="stylesheet" href="../../assets/css/global.css">
    <link rel="stylesheet" href="../../assets/css/project-css/cadastrar-projeto.css">
</head>

<body>
    <div class="container">

        <header class="cabecalho">
            <h1 class="titulo-pagina">CADASTRAR <br> PROJETO</h1>

            <a href="../../index.html" class="botao-fechar" aria-label="Fechar cadastro de projeto">
                <img src="../../assets/icons/botao-fechar-amarelo.svg" alt="">
            </a>
        </header>

        <main class="conteudo">
            <section class="secao-cadastro">

                <form id="formulario" class="formulario" method="post">

                    <!-- NOME DO PROJETO -->
                    <div class="campo-grupo">
                        <label for="preco" class="campo-rotulo">NOME</label>
                        <input type="text" id="preco" name="nomeProjeto" class="campo-entrada" required>
                    </div>

                    <!-- SETOR -->
                    <div class="campo-grupo">
                        <span class="campo-rotulo">SETOR</span>

                        <div class="grupo-radio">
                            <input type="radio" name="setor" id="robotica" value="robotica" required>
                            <label for="robotica" class="rotulo-radio">
                                Robótica
                            </label>

                            <input type="radio" name="setor" id="manutencao" value="manutencao">
                            <label for="manutencao" class="rotulo-radio borda-esquerda">
                                Manutenção
                            </label>
                        </div>
                    </div>

                    <!-- PREÇO -->
                    <div class="campo-grupo">
                        <label for="preco" class="campo-rotulo">
                            PREÇO <span class="texto-opcional">(OPCIONAL)</span>
                        </label>

                        <div class="campo-preco">
                            <span class="prefixo-moeda">R$</span>
                            <input type="text" id="preco" name="preco" class="campo-entrada" inputmode="decimal"
                                autocomplete="off">
                        </div>
                    </div>

                    <!-- OBSERVAÇÕES -->
                    <div class="campo-grupo">
                        <label for="observacoes" class="campo-rotulo">
                            OBSERVAÇÕES <span class="texto-opcional">(OPCIONAL)</span>
                        </label>

                        <textarea id="observacoes" name="observacoes" class="campo-texto" rows="4"></textarea>
                    </div>

                    <!-- ITENS -->
                    <div class="grupo-tabela">

                        <!-- PESQUISA -->
                        <div class="campo-grupo">
                            <label for="pesquisa-item" class="campo-rotulo">
                                ITENS <span class="texto-opcional">(OPCIONAL)</span>
                            </label>

                            <div class="grupo-pesquisa-filtro">
                                <div class="container-pesquisa">
                                    <input type="text" class="campo-entrada" id="pesquisa-item" name="pesquisaItem">

                                    <div class="icone-pesquisa">
                                        <button type="button" class="botao-pesquisa" aria-label="Pesquisar item">
                                            <img src="../../assets/icons/icon-pesquisa.svg" alt="">
                                        </button>
                                    </div>
                                </div>

                                <div class="icone-filtro">
                                    <button type="button" class="botao-filtro" aria-label="Filtrar itens">
                                        <img src="../../assets/icons/icon-filtro.svg" alt="">
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- TABELA -->
                        <table class="tabela-itens">
                            <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">ITEM</th>
                                    <th scope="col">QTD</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>

                            <tbody>
                                <tr>
                                    <td>23-002</td>
                                    <td>Cabo</td>
                                    <td>x2</td>
                                    <td>
                                        <button type="button" class="botao-excluir" aria-label="Remover item Cabo">
                                            <img src="../../assets/icons/icon-excluir.svg" alt="">
                                        </button>
                                    </td>
                                </tr>

                                <tr>
                                    <td>04-001</td>
                                    <td>Fonte</td>
                                    <td>x1</td>
                                    <td>
                                        <button type="button" class="botao-excluir" aria-label="Remover item Fonte">
                                            <img src="../../assets/icons/icon-excluir.svg" alt="">
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- AÇÕES -->
                    <div class="grupo-acoes">
                        <button type="submit" class="botao">
                            CADASTRAR
                        </button>
                    </div>

                </form>
            </section>
        </main>
    </div>
    
    <script>
        document.getElementById('formulario').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nome = document.getElementById('item').value;
            const obs = document.getElementById('observacoes').value;
            const setor = document.querySelector('input[name="destino"]:checked')?.value;

            try {
                const response = await fetch('http://localhost:3000/api/cadastrar-projeto', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ item: nome, destino: setor, observacoes: obs })
                });
                const result = await response.json();

                if (result.success) {
                    const params = new URLSearchParams({
                        id: result.id, nome: nome, setor: setor || '-', obs: obs || '-'
                    });
                    window.location.href = `projeto-cadastrado.html?${params.toString()}`;
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (err) { alert('Erro de conexão.'); }
        });
    </script>
</body>

</html>