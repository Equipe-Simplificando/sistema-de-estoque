<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etiqueta Gerada</title>
    <link rel="stylesheet" href="../../assets/css/global.css">
    <link rel="stylesheet" href="../../assets/css/material-css/etiqueta-gerada.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>
    <div class="container">

        <header class="cabecalho">
            <button class="botao-fechar" type="button" onclick="window.location.href='listar-materiais.html'"
                aria-label="Fechar janela">
                <img src="../../assets/icons/botao-fechar.svg" alt="Botão fechar">
            </button>
        </header>

        <main class="conteudo">
            <h1 class="titulo-pagina">ETIQUETA <br> GERADA!</h1>
            
            <section class="secao-etiqueta">
                
                <div class="container-lembrete">
                    <p class="texto-lembrete">Lembre-se de conferir a etiqueta antes de colar no material.</p>
                </div>

                <section class="dados-etiqueta">
                    <span class="rotulo-dado">ID:</span>
                    <span class="valor-dado" id="view_id"></span>

                    <span class="rotulo-dado">Item:</span>
                    <span class="valor-dado" id="view_nome"></span>

                    <span class="rotulo-dado">Destino:</span>
                    <span class="valor-dado" id="view_destino"></span>

                    <span class="rotulo-dado">Projeto:</span>
                    <span class="valor-dado" id="view_projeto"></span>
                </section>

                <div class="qrcode-wrapper">
                    <div id="qrcode"></div>
                </div>

                <section class="secao-observacoes">
                    <h2 class="titulo-secao">OBSERVAÇÕES:</h2>
                    <p class="texto-observacoes" id="view_obs">
                        -
                    </p>
                </section>

                <div class="grupo-acoes">

                    <a href="../material-pages/cadastrar-material.html" class="botao">
                        CADASTRAR MAIS
                    </a>

                    <button type="button" id="btn-editar" class="botao botao-branco">
                        EDITAR
                    </button>

                    <button type="button" class="botao-imprimir" onclick="window.print()">
                        REIMPRIMIR ETIQUETA
                    </button>

                </div>

            </section>
        </main>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        const nome = params.get('nome');
        const destino = params.get('destino');
        const projeto = params.get('projeto');
        const obs = params.get('obs');
        const codigoParaQRCode = params.get('cod') || id || 'ERRO';

        if (id) document.getElementById('view_id').innerText = id;
        if (nome) document.getElementById('view_nome').innerText = nome;

        if (destino) {
            document.getElementById('view_destino').innerText = destino.charAt(0).toUpperCase() + destino.slice(1);
        } else {
            document.getElementById('view_destino').innerText = '-';
        }

        document.getElementById('view_projeto').innerText = (projeto && projeto !== 'null') ? projeto : '-';
        
        // CORREÇÃO: Agora o ID view_obs existe no HTML acima
        document.getElementById('view_obs').innerText = (obs && obs !== 'null') ? obs : 'Sem observações.';

        if (id) {
            // Limpa QR Code anterior se houver
            document.getElementById("qrcode").innerHTML = "";
            
            new QRCode(document.getElementById("qrcode"), {
                text: codigoParaQRCode,
                width: 128, // Aumentei um pouco para melhor leitura na impressão
                height: 128,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // Lógica do Botão EDITAR
        document.getElementById('btn-editar').addEventListener('click', () => {
            const paramsEdit = new URLSearchParams({
                id: id,      
                nome: nome,   
                destino: destino, 
                projeto: projeto, 
                obs: obs      
            });
            window.location.href = `editar-material.html?${paramsEdit.toString()}`;
        });
    </script>
</body>

</html>