<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Material</title>
    <link rel="stylesheet" href="../../assets/css/global.css">
    <link rel="stylesheet" href="../../assets/css/material-screen/cadastrar-material.css">
</head>

<body>
    <div class="container-geral">

        <header class="cabecalho">
            <h1 class="titulo-pagina">CADASTRAR <br> MATERIAL</h1>

            <button class="botao-fechar" type="button" aria-label="Fechar janela">
                <img src="../../assets/icons/botao-fechar.svg" alt="Botão fechar">
            </button>
        </header>

        <main class="conteudo-principal">
            <section class="secao-formulario">

                <form id="formulario" class="formulario" action="#" method="POST">

                    <div class="grupo-campo">
                        <label for="item" class="rotulo-campo">NOME DO ITEM</label>
                        <input type="text" id="item" name="item" class="campo-entrada" required>
                    </div>

                    <div class="grupo-campo">
                        <label class="rotulo-campo">DESTINO</label>

                        <div class="grupo-radio">
                            <input type="radio" name="destino" id="robotica" value="robotica" required>
                            <label for="robotica" class="rotulo-radio">Robótica</label>

                            <input type="radio" name="destino" id="manutencao" value="manutencao">
                            <label for="manutencao" class="rotulo-radio borda-esquerda">Manutenção</label>
                        </div>
                    </div>

                    <div class="grupo-campo">
                        <label for="projeto" class="rotulo-campo">
                            Projeto <span class="texto-opcional">(OPCIONAL)</span>
                        </label>

                        <div class="container-select">
                            <select id="projeto" name="projeto" class="campo-entrada select-customizado">
                                <option value="" selected disabled hidden></option>
                                <option value="projeto1">Projeto 1</option>
                                <option value="projeto2">Projeto 2</option>
                                <option value="projeto3">Projeto 3</option>
                            </select>

                            <div class="icone-seta">
                                <img src="../../assets/icons/icon-seta.svg" alt="Ícone seta">
                            </div>
                        </div>
                    </div>

                    <div class="grupo-campo">
                        <label for="observacoes" class="rotulo-campo">
                            OBSERVAÇÕES <span class="texto-opcional">(OPCIONAL)</span>
                        </label>
                        <textarea id="observacoes" name="observacoes" class="campo-texto" rows="4"></textarea>
                    </div>

                    <button type="submit" class="botao">GERAR ETIQUETA</button>

                </form>

                <a href="listar-materiais.html" class="botao" style="background-color: #666; margin-top: 10px; text-align:center; text-decoration:none; display:block;">
    VER ESTOQUE
</a>
            </section>
        </main>
    </div>
    <script>
    document.getElementById('formulario').addEventListener('submit', async (e) => {
        e.preventDefault(); // Evita que a página recarregue (Live Update)

        // Captura os valores dos campos corretos do HTML
        const itemNome = document.getElementById('item').value;
        
        // Pega o valor do rádio selecionado (Destino)
        const destinoSelecionado = document.querySelector('input[name="destino"]:checked');
        const destino = destinoSelecionado ? destinoSelecionado.value : null;

        const projeto = document.getElementById('projeto').value;
        const observacoes = document.getElementById('observacoes').value;

        // Objeto com os dados para enviar ao backend
        const dados = {
            item: itemNome,
            destino: destino,
            projeto: projeto,
            observacoes: observacoes
        };

        try {
            // Envia para o servidor Node.js
            const response = await fetch('http://localhost:3000/api/cadastrar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            });

            const result = await response.json();

            if (result.success) {
                console.log('Sucesso:', result);
                // Redireciona para a etiqueta gerada passando os dados
                const params = new URLSearchParams({
                    nome: dados.item,
                    id: result.id,
                    cod: 'MAT-' + result.id // Exemplo de código gerado
                });
                window.location.href = `etiqueta-gerada.html?${params.toString()}`;
            } else {
                alert('Erro ao cadastrar: ' + (result.error || 'Erro desconhecido'));
            }
        } catch (err) {
            console.error(err);
            alert('Erro de conexão. Verifique se o servidor (server.js) está rodando.');
        }
    });
</script>
</body>
</html>
